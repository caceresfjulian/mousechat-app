import React, { useContext, useState } from 'react';
import axios from 'axios';
import AuthContext from '../context/AuthContext';
import { useHistory } from 'react-router';

function Login() {
    const [email, setEmail] = useState("");
    const [password, setPassword] = useState("");
    //definimos los datos que serán capturados para ser enviados al back.

    const { obtenerLoggeo } = useContext(AuthContext);
    const historial = useHistory();

    //Definimos una función ASÍNCRONA para el onSubmit del form
    async function loggeo(e) {
        e.preventDefault();

        // Escribimos un try catch para enviar la solicitud al backend, almacenar la info en una const.
        // Aquí podríamos usar fetch para enviar la info, pero es preferible axios por su simpleza.
        try {
            const datosLogin = {
                email,
                password
            };

            await axios.post("http://localhost:4000/auth/login", datosLogin);
            //Hay que habilitar el uso de cookies, entonces en app.js añadimos withcredentials.

            await obtenerLoggeo();
            historial.push("/join");
            //Añadimos de nuevo esto para actualizar el contexto y redireccionar.

        } catch (error) {
            console.error(error);
        }
    }


    //Creamos una encuesta común.
    return (
        //Añadimos a cada input el valor y hook asociado por onChange.
        <>
            <div style={{ maxWidth: 1000, margin: 'auto' }}>
                <h1 style={{ fontWeight: 1, paddingLeft: 30, paddingTop: 15 }}>Welcome back...</h1>
            </div>
            <div className="container">
                <div>
                    <svg width="400" viewBox="0 0 647 386" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M495.358 381.635C487.075 374.65 482.044 363.617 483.363 352.875C484.683 342.134 492.855 332.26 503.456 329.979C514.057 327.698 526.141 334.012 529.361 344.345C531.133 324.423 533.175 303.665 543.79 286.699C553.401 271.336 570.048 260.344 588.09 258.377C606.131 256.41 625.127 263.838 636.379 278.048C647.631 292.258 650.386 312.916 642.505 329.231C636.7 341.249 626.004 350.193 614.798 357.469C578.587 380.784 535.157 390.265 492.498 384.168L495.358 381.635Z" fill="#F2F2F2" />
                        <path d="M618.538 264.25C603.651 276.349 589.994 289.882 577.765 304.652C558.626 327.687 543.138 353.514 531.841 381.233C531.014 383.255 534.305 384.136 535.123 382.136C553.606 337.087 583.113 297.382 620.944 266.651C622.643 265.27 620.223 262.881 618.538 264.25Z" fill="white" />
                        <path d="M208.28 379.737C219.657 370.144 226.568 354.989 224.755 340.236C222.943 325.483 211.718 311.92 197.158 308.787C182.597 305.654 165.999 314.327 161.577 328.52C159.143 301.156 156.338 272.645 141.759 249.342C128.558 228.242 105.693 213.143 80.9131 210.442C56.1329 207.741 30.0425 217.943 14.588 237.46C-0.866457 256.978 -4.65042 285.352 6.1735 307.76C14.1471 324.267 28.8373 336.551 44.229 346.546C93.3337 378.431 154.248 391.729 212.209 383.217" fill="#F2F2F2" />
                        <path d="M39.0927 218.508C59.5394 235.127 78.2971 253.714 95.0945 274.001C111.895 294.266 126.685 316.11 139.259 339.225C146.287 352.192 152.6 365.532 158.171 379.185C159.306 381.963 154.787 383.172 153.664 380.425C143.797 356.354 131.589 333.306 117.217 311.611C102.914 289.995 86.5437 269.815 68.3358 251.353C58.0373 240.916 47.1716 231.053 35.7877 221.806C33.4544 219.91 36.7786 216.628 39.0926 218.508L39.0927 218.508Z" fill="white" />
                        <path d="M464.427 385.155H192.984V107.235C192.984 48.1053 241.191 0 300.446 0H356.966C416.22 0 464.427 48.1053 464.427 107.235V385.155Z" fill="#F2F2F2" />
                        <path d="M407.908 385.155H192.984V107.235C192.925 84.5778 200.115 62.4933 213.507 44.1969C214 43.5254 214.493 42.8627 215.001 42.2072C221.478 33.7294 229.187 26.2631 237.872 20.0548C238.362 19.6986 238.855 19.3485 239.355 18.9985C246.622 13.9799 254.484 9.87732 262.76 6.78411C263.252 6.59821 263.752 6.41196 264.252 6.23331C271.738 3.56771 279.497 1.74178 287.387 0.789248C287.876 0.72257 288.378 0.670393 288.88 0.618215C296.569 -0.202165 304.324 -0.202165 312.013 0.618215C312.514 0.670393 313.016 0.722563 313.511 0.789962C321.399 1.74256 329.156 3.56826 336.639 6.23334C337.14 6.41199 337.64 6.59824 338.133 6.78449C346.308 9.83869 354.077 13.8801 361.267 18.8184C361.766 19.1608 362.266 19.5109 362.759 19.8609C367.627 23.3286 372.2 27.1918 376.43 31.4111C379.823 34.7954 382.984 38.403 385.893 42.2094C386.399 42.8627 386.892 43.5255 387.384 44.1958C400.777 62.4925 407.967 84.5774 407.908 107.235V385.155Z" fill="#CCCCCC" />
                        <path d="M390.431 260.852C397.003 260.852 402.33 255.536 402.33 248.978C402.33 242.42 397.003 237.104 390.431 237.104C383.86 237.104 378.532 242.42 378.532 248.978C378.532 255.536 383.86 260.852 390.431 260.852Z" fill="#FF0000" />
                        <path d="M442.19 376.831H433.073L428.735 341.738L442.192 341.739L442.19 376.831Z" fill="#FFB8B8" />
                        <path d="M426.56 374.231H444.143V385.279H415.489C415.489 383.828 415.775 382.391 416.332 381.051C416.888 379.711 417.704 378.493 418.732 377.467C419.76 376.441 420.98 375.627 422.323 375.072C423.667 374.517 425.106 374.231 426.56 374.231Z" fill="#2F2E41" />
                        <path d="M487.555 376.831H478.437L474.099 341.738L487.556 341.739L487.555 376.831Z" fill="#FFB8B8" />
                        <path d="M471.925 374.231H489.508V385.279H460.854C460.854 383.828 461.14 382.391 461.696 381.051C462.253 379.711 463.068 378.493 464.096 377.467C465.124 376.441 466.345 375.627 467.688 375.072C469.031 374.517 470.471 374.231 471.925 374.231Z" fill="#2F2E41" />
                        <path d="M396.453 251.33C395.797 250.366 395.361 249.27 395.176 248.119C394.99 246.968 395.06 245.791 395.38 244.67C395.699 243.549 396.262 242.512 397.027 241.631C397.792 240.75 398.741 240.048 399.807 239.573L430.801 154.329L446.052 162.634L410.664 244.096C411.345 245.937 411.325 247.963 410.609 249.791C409.893 251.618 408.53 253.12 406.778 254.012C405.027 254.903 403.008 255.123 401.105 254.629C399.202 254.134 397.547 252.961 396.453 251.33Z" fill="#FFB8B8" />
                        <path d="M482.897 267.348C481.884 266.768 481.011 265.974 480.338 265.021C479.666 264.068 479.211 262.979 479.006 261.832C478.801 260.684 478.851 259.506 479.151 258.38C479.452 257.254 479.996 256.207 480.746 255.313L471.145 165.14L488.5 165.931L492.491 254.629C493.911 255.985 494.784 257.815 494.944 259.77C495.103 261.726 494.538 263.672 493.355 265.24C492.173 266.808 490.455 267.888 488.528 268.277C486.6 268.665 484.597 268.335 482.897 267.348Z" fill="#FFB8B8" />
                        <path d="M455.21 138.54C465.298 138.54 473.475 130.379 473.475 120.313C473.475 110.246 465.298 102.086 455.21 102.086C445.122 102.086 436.944 110.246 436.944 120.313C436.944 130.379 445.122 138.54 455.21 138.54Z" fill="#FFB8B8" />
                        <path d="M482.781 246.84H427.714L427.78 246.412C427.879 245.773 437.594 182.265 430.429 161.488C429.71 159.446 429.773 157.211 430.606 155.213C431.44 153.215 432.984 151.595 434.942 150.665H434.943C445.184 145.853 464.844 139.926 481.437 154.309C483.879 156.46 485.786 159.148 487.007 162.162C488.228 165.175 488.729 168.431 488.472 171.671L482.781 246.84Z" fill="#FF0000" />
                        <path d="M438.29 191.65L413.498 186.631L425.119 159.151C425.815 156.489 427.54 154.212 429.916 152.818C432.292 151.423 435.125 151.027 437.794 151.714C440.463 152.402 442.749 154.117 444.152 156.485C445.555 158.853 445.96 161.679 445.277 164.344L438.29 191.65Z" fill="#FF0000" />
                        <path d="M470.042 200.969L468.552 166.876C467.421 160.467 471.098 154.408 476.752 153.418C482.408 152.431 487.931 156.876 489.066 163.332L494.669 195.189L470.042 200.969Z" fill="#FF0000" />
                        <path d="M480.948 242.758C489.809 276.433 490.776 319.247 488.385 365.948L476.486 364.464L454.92 275.411L443.021 365.948L429.635 365.206C425.636 316.205 421.742 274.138 428.147 246.469L480.948 242.758Z" fill="#2F2E41" />
                        <path d="M467.245 134.399C463.838 138.021 457.509 136.077 457.065 131.129C457.03 130.744 457.033 130.358 457.073 129.974C457.302 127.782 458.571 125.792 458.267 123.478C458.198 122.902 457.983 122.353 457.642 121.883C454.927 118.255 448.553 123.506 445.99 120.221C444.419 118.207 446.266 115.036 445.06 112.785C443.469 109.814 438.755 111.28 435.798 109.652C432.509 107.842 432.706 102.806 434.871 99.7433C437.512 96.0078 442.141 94.0146 446.713 93.7273C451.285 93.44 455.825 94.6733 460.094 96.3332C464.943 98.2191 469.752 100.826 472.737 105.081C476.366 110.256 476.715 117.213 474.9 123.264C473.796 126.945 470.028 131.441 467.245 134.399Z" fill="#2F2E41" />
                        <path d="M624.676 385.633H75.6229C75.3885 385.632 75.164 385.538 74.9984 385.373C74.8329 385.207 74.74 384.983 74.74 384.749C74.74 384.515 74.8329 384.291 74.9984 384.125C75.164 383.959 75.3885 383.866 75.6229 383.865H624.676C624.91 383.866 625.135 383.959 625.3 384.125C625.466 384.291 625.559 384.515 625.559 384.749C625.559 384.983 625.466 385.207 625.3 385.373C625.135 385.538 624.91 385.632 624.676 385.633Z" fill="#3F3D56" />
                        <path d="M348.785 304.636H252.107C250.834 304.643 249.61 304.146 248.703 303.253C247.797 302.361 247.283 301.146 247.273 299.875V84.5377C247.283 83.2671 247.797 82.0524 248.703 81.1599C249.61 80.2673 250.834 79.77 252.107 79.7768H348.785C350.058 79.77 351.282 80.2673 352.188 81.1599C353.095 82.0524 353.609 83.2671 353.619 84.5377V299.875C353.609 301.146 353.095 302.361 352.188 303.253C351.282 304.146 350.058 304.643 348.785 304.636Z" fill="white" />
                        <path d="M353.619 149.453H247.273V150.937H353.619V149.453Z" fill="#CCCCCC" />
                        <path d="M353.991 234.136H247.645V235.62H353.991V234.136Z" fill="#CCCCCC" />
                        <path d="M282.226 79.7768H280.739V305.378H282.226V79.7768Z" fill="#CCCCCC" />
                        <path d="M319.41 79.7768H317.922V305.378H319.41V79.7768Z" fill="#CCCCCC" />
                    </svg>
                    <p style={{ textAlign: 'center', marginTop: 30 }}>Don’t want to create an account? <br />
                        <a href="/" style={{ color: '#FF0000' }}>Login</a> with our dummy profile
                        </p>
                    <form onSubmit={loggeo} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                        <input
                            type="email"
                            placeholder="Correo electrónico"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            style={{ background: '#FFFFFF', border: '5px solid #AFAFAF', boxSizing: 'border-box', borderRadius: 30, width: 300, padding: 5, paddingLeft: 15, marginBottom: 20 }}
                        />
                        <input
                            type="password"
                            placeholder="Contraseña"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            style={{ background: '#FFFFFF', border: '5px solid #AFAFAF', boxSizing: 'border-box', borderRadius: 30, width: 300, padding: 5, paddingLeft: 15, marginBottom: 20 }}
                        />
                        <button type="submit" className="nav-button">Log in</button>
                        <p style={{ textAlign: 'center', marginTop: 30 }}>
                           Or <a href="/" style={{ color: '#FF0000' }}>create</a> an account!
                        </p>
                    </form>
                </div>
            </div>
        </>
    )
}

export default Login
